[N1]Demo[/N1]
[HTML]<table>
	<tbody>
		<tr>
			<td>Dimension <10-50></td>
			<td>Speed (ms) <1-50></td>
			<td></td>
		</tr>
		<tr>				
			<td><input id="starsInput" style="width: 80px;" value="50">	
			<td><input id="speedInput" style="width: 160px;" value="5"></td>				
			<td><button type="button" onclick="$.stars.start()">Run!</button></td>
		</tr>		
	</tbody>
</table>
<div style="margin: 10px 0;">
	<canvas id="myCanvas" width="1400" height="600"></canvas>
</div>
<div id="status"></div>[/HTML]
<script>let $ = {};
$.stars = (function() {	
	
	let canvas = document.getElementById("myCanvas");
	let ctx = canvas.getContext("2d");
	let width;
	let height;
	let halfWidth;
	let halfHeight;
	let stars;
		
	let angle = 0;
	let shift = 0;
	
	let interval = 20;
	let innerIntervalCallback;		
	
	let cache = [];
	
	let resetCache = function() {
		cache = [];
	};
	
	let readCache = function(x, y) {
		let c1 = cache[x];
		if (typeof c1 === "undefined") {
			c1 = [];
			cache[x] = c1;			
		}
		if (typeof c1[y] === "undefined") 		
			c1[y] = {
				a: Math.atan(y / x),
				r: Math.sqrt(x * x + y * y)
			}
		return c1[y];
	};
	
	let draw = function() {				
		ctx.fillStyle = "black";
		ctx.fillRect(0, 0, width, height);
						
		angle = (angle + 0.5) % 360; 
		shift = (shift + 0.1) % 10;
	
		let rad = angle / 180 * Math.PI;	

		let focusLength = 20;
		let saturation = 70;
		
		let layers = 5;
		for (let layer = 1; layer < layers; layer++) {
			let coef = layer + shift / 10;			
			//let scale = Math.pow(coef, 1.5) / 10;
			//let dw = (width / stars) * scale;
			//let dh = (height / stars) * scale;
			let count = stars + 10 / coef;
			// pro vÅ¡echny 4 kvadranty
			for (let ma = 0; ma < 4; ma++) {
				for (let x = 0; x < count; x++) {			
					for (let y = 0; y < count; y++) {
						if (x == 0 || y == 0)
							continue;				
						if (Math.abs(x) == 1 || Math.abs(y) == 1) {
							ctx.fillStyle = "hsl(0, " + (coef * saturation / layers + (100 - saturation)) + "%, " + (coef * 50 / layers) + "%)";
						} else {
							ctx.fillStyle = "hsl(10, " + (coef * saturation / layers) + "%, " + (coef * 50 / layers) + "%)";
						}
							
						let c = readCache(x, y);									
						let r = c.r * coef;
						// https://en.wikipedia.org/wiki/3D_projection#Diagram
						let viewDistance = r * focusLength / (layers - (layer + shift / 10));
						let sx = halfWidth + Math.cos(rad + c.a + ma * Math.PI / 2) * viewDistance;
						let sy = halfHeight + Math.sin(rad + c.a + ma * Math.PI / 2) * viewDistance;	
						if (sx < 0 || sy < 0 || sx > width || sy > height)
							continue;
						ctx.fillRect(sx, sy, coef, coef);				
					}
				}
			}
		}
		/*
		ctx.fillStyle = "red"; 
		ctx.fillRect(0, halfHeight, width, 1);
		ctx.fillRect(halfWidth, 0, 1, height);
		*/
	};

	let innnerChangeInterval = function(value) {
		if (isNaN(value))
			return;
		let newValue = Number(value);
		if (newValue < 1)
			return;
		console.log("interval changed from '" + interval + "' to '" + newValue + "'");
		interval = newValue;
		
		if (innerIntervalCallback) 
			clearInterval(innerIntervalCallback);
		
		innerIntervalCallback = setInterval(function() {
			draw();
		}, interval);
	};

	let validate = function(msg, field, min, max) {
		let value = document.getElementById(field).value;
		if (isNaN(value)) {
			alert(msg);
			return false;
		}
		value = Number(value);
		if (value < min || value > max) {
			alert(msg);
			return false;
		}
		return value;
	};

	let init = function() {		
		let speedParam = validate("Invalid speed", "speedInput", 1, 50);	
		let starsParam = validate("Invalid stars", "starsInput", 10, 500);	
		if (speedParam && starsParam) {	
			width = canvas.width;
			height = canvas.height;
			halfWidth = width / 2; 
			halfHeight = height / 2;
			stars = starsParam;
			innnerChangeInterval(speedParam);	
		}
	};

	return {
		start: function() {	
			init();			
		}
	};

})();

$.stars.start();</script>