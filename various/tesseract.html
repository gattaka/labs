[N1]Demo[/N1]
[HTML]<table>
	<tbody>
		<tr>
			<td>Radius <2-20></td>
			<td>Layers <2-10></td>
			<td>Speed (ms) <1-50></td>
			<td></td>
		</tr>
		<tr>				
			<td><input id="pointsInput" style="width: 80px;" value="20">	
			<td><input id="layersInput" style="width: 80px;" value="6">	
			<td><input id="speedInput" style="width: 160px;" value="10"></td>				
			<td><button type="button" onclick="$.stars.start()">Run!</button></td>
		</tr>		
	</tbody>
</table>
<div style="margin: 10px 0;">
	<canvas id="myCanvas" width="700" height="600"></canvas>
</div>
<div id="status"></div>[/HTML]
<script>let $ = {};
$.stars = (function() {	
	
	let canvas = document.getElementById("myCanvas");
	let ctx = canvas.getContext("2d");
	let width;
	let height;
	let halfWidth;
	let halfHeight;
	
	let points;
	let layers;
	let layer = [];
		
	let angle = 0;
	let shift = 0;
	
	let interval = 20;
	let innerIntervalCallback;		
	
	let cache = [];
	
	let resetCache = function() {
		cache = [];
	};
	
	let readCache = function(x, y) {
		let c1 = cache[x];
		if (typeof c1 === "undefined") {
			c1 = [];
			cache[x] = c1;			
		}
		if (typeof c1[y] === "undefined") 		
			c1[y] = {
				a: Math.atan(y / x),
				r: Math.sqrt(x * x + y * y)
			}
		return c1[y];
	};
	
	let draw = function() {				
		ctx.fillStyle = "black";
		ctx.fillRect(0, 0, width, height);
						
		angle = (angle + 1) % 3600; 
		shift = (shift + 1) % 100;
	
		let rad = angle / 1800 * Math.PI;	

		let focusLength = 20;
		let saturation = 80;				
				
		for (let i = 1; i < layers; i++) {
			let color = angle;			
			let coef = i + shift / 100;			
			//let scale = Math.pow(coef, 1.5) / 10;
			//let dw = (width / stars) * scale;
			//let dh = (height / stars) * scale;
			let count = Math.ceil(points + 10 / coef);
			// pro vÅ¡echny 4 kvadranty
			for (let ma = 0; ma < 4; ma++) { 
				ctx.fillStyle = "hsl(" + color + ", " + (coef * saturation / layers) + "%, " + (coef * 70 / layers) + "%)";
				ctx.strokeStyle = ctx.fillStyle;
				let corners = [];
				for (let x = 0; x < count; x++) {			
					for (let y = 0; y < count; y++) {
						if (x == 0 || y == 0)
							continue;										
						let c = readCache(x, y);									
						let r = c.r * coef;
						let a = c.a;// + Math.PI / 10 * i / layers;
						// https://en.wikipedia.org/wiki/3D_projection#Diagram
						let viewDistance = r * focusLength / (layers - (i + shift / 100));
						let sx = halfWidth + Math.cos(rad + a + ma * Math.PI / 2) * viewDistance;
						let sy = halfHeight + Math.sin(rad + a + ma * Math.PI / 2) * viewDistance;	
						
						let size = coef;				
						ctx.lineWidth = size / 2;						
						if (x == 1 && y == 1) {
							corners[1] = [sx, sy];							
						} else if (x == 1 && y == count - 1) {
							corners[2] = [sx, sy];
						} else if (x == count - 1 && y == 1) {			
							ctx.beginPath();
							ctx.moveTo(sx, sy);
							ctx.lineTo(corners[1][0], corners[1][1]);						
							ctx.lineTo(corners[2][0], corners[2][1]);
							ctx.stroke();
						} else if (sx > 0 && sy > 0 && sx < width && sy < height && x > 1 && y > 1) {
							ctx.fillRect(sx, sy, size, size);								
						}						
					}
				}
			}
		}
	};

	let innnerChangeInterval = function(value) {
		if (isNaN(value))
			return;
		let newValue = Number(value);
		if (newValue < 1)
			return;
		console.log("interval changed from '" + interval + "' to '" + newValue + "'");
		interval = newValue;
		
		if (innerIntervalCallback) 
			clearInterval(innerIntervalCallback);
		
		innerIntervalCallback = setInterval(function() {
			draw();
		}, interval);
	};

	let validate = function(msg, field, min, max) {
		let value = document.getElementById(field).value;
		if (isNaN(value)) {
			alert(msg);
			return false;
		}
		value = Number(value);
		if (value < min || value > max) {
			alert(msg);
			return false;
		}
		return value;
	};

	let init = function() {		
		let speedParam = validate("Invalid speed", "speedInput", 1, 50);	
		let pointsParam = validate("Invalid points", "pointsInput", 2, 20);	
		let layersParam = validate("Invalid stars", "layersInput", 2, 10);			
		if (speedParam && pointsParam && layersParam) {	
			width = canvas.width;
			height = canvas.height;
			halfWidth = width / 2; 
			halfHeight = height / 2;
			points = pointsParam;
			layers = layersParam;
			innnerChangeInterval(speedParam);	
			
			for (let i = 1; i < layers; i++) 
				layer[i] = {a: 0, d: 0};					
		}
	};

	return {
		start: function() {	
			init();			
		}
	};

})();

$.stars.start();</script>