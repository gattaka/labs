<head>	
	<script type="text/javascript" src="../libs/colors.js"></script>
</head>

<div style="margin: 10px 0;">
	<canvas id="canvas" width="700" height="400"></canvas>
</div>
<script>let $ = {};
$.perlin = (function() {

	let canvas = document.getElementById("canvas");
	let ctx = canvas.getContext("2d");
	let width;
	let height;
	let halfWidth;
	let halfHeight;
	
	let grid;
	let gridSize;
	let vectorMax;
	let cellWidth;
	let cellHeight;
		
	let fillSegment = function(tree) {		
		let color = getColorByLevel(tree.level);
		ctx.fillStyle = color;
		ctx.strokeStyle = "black";
		let x = tree.x - tree.w / 2;
		let y = tree.y - tree.h / 2;		
		ctx.fillRect(x, y, tree.w, tree.h);
		ctx.strokeRect(x, y, tree.w, tree.h);		
	};
	
	let distance = function(vectorWidth, vectorHeight, pointCellX, pointCellY) {
		if (vectorHeight == 0)
			return Math.abs(pointCellY - vectorWidth);
		return Math.sqrt(
	};

	let init = function() {	
		width = canvas.width;
		height = canvas.height;
		halfWidth = width / 2; 
		halfHeight = height / 2;
		
		grid = [];
		gridSize = 10;
		vectorMax = 20;
		cellWidth = width / gridSize;
		cellHeight = height / gridSize;
	
		ctx.clearRect(0, 0, width, height);
		
		ctx.lineWidth = 1;
		ctx.strokeStyle = "blue";
		ctx.strokeRect(0, 0, width, height);

		for (let y = 0; y <= gridSize; y++) {
			let row = [];
			grid[y] = row;
			for (let x = 0; x <= gridSize; x++) {
				let cx = x * cellWidth;
				let lx = vectorMax * (Math.random() * 2 - 1);
				let ly = vectorMax * (Math.random() * 2 - 1);
				row[x] = [
					lx,
					ly,
					Math.sqrt(lx * lx + ly * ly),
					lx / ly
				];
			}
		}
				
		for (let y = 0; y < height; y++) {			
			for (let x = 0; x < width; x++) {
				let cellX = Math.round(x / cellWidth);
				let cellY = Math.round(y / cellHeight);
				let vector = grid[cellY][cellX];
				// vnitřní souřadnice bodu vzhledem k centru buňky
				let pointCellX = cellX * cellWidth - x;
				let pointCellY = cellY * cellHeight - y;
				//ctx.fillStyle = (cellX + cellY) % 2 == 0 ? "white" : "lightgrey";
				ctx.fillStyle = $.GJSLibColors.hslToRGB(l / layersSizes.length, 1, 0.4);
				ctx.fillRect(x, y, 1, 1);
			}
		}
				
		for (let y = 0; y <= gridSize; y++) {
			let cy = y * cellHeight;
			ctx.strokeStyle = "blue";
			ctx.beginPath();
			ctx.moveTo(0, cy);
			ctx.lineTo(width, cy);
			ctx.stroke();	
			for (let x = 0; x <= gridSize; x++) {
				let cx = x * cellWidth;
				if (y == 0) {
					ctx.strokeStyle = "blue";
					ctx.beginPath();
					ctx.moveTo(cx, 0);
					ctx.lineTo(cx, height);
					ctx.stroke();
				}				
				ctx.lineWidth = 2;
				ctx.strokeStyle = "red";
				ctx.beginPath();
				ctx.moveTo(cx, cy);
				ctx.lineTo(cx + grid[y][x][0], cy + grid[y][x][1]);
				ctx.stroke();
				ctx.lineWidth = 1;
			}
		}	

	};	
		
	return {

		start: function() {	
			init();			
		},
		
	};

})();

$.perlin.start();</script>