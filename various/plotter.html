<html>
<body>
<div>
<canvas id="can" width="500" height="300" style="cursor: pointer"></canvas>
</div>
<script>let $ = {};
$.plotter = (function() {
	
	let canvas = document.getElementById("can");
	let ctx = canvas.getContext("2d");
	let width = canvas.offsetWidth;
	let height = canvas.offsetHeight;	
	let dragged = false;
	let draggedStartX;
	let draggedStartY;
	
	let xUnit = 0.5;
	let yUnit = 2;
	let xCenter = -5;
	let yCenter = 2;
	
	let xUnitOriginal = xUnit;
	let yUnitOriginal = yUnit;
	
	let xLength;
	let yLength;
	let cyUnit;
	let cxUnit;
	
	// kolik px má na jednotka na ose
	let axisUnitPxSize = 50;
	let xAxisSteps = Math.ceil(width / axisUnitPxSize);	
	let yAxisSteps = Math.ceil(height / axisUnitPxSize);	
	
	let cxOffset;
	let cyOffset;
	
	let func = function(x) {
		return x * x;
	};
	
	let calibrate = function() {			
		xLength = xAxisSteps * xUnit;
		yLength = yAxisSteps * yUnit;
		cyUnit = height / yLength;
		cxUnit = width / xLength;
	};
	
	let init = function() {	
		calibrate();
		xUnit = xUnitOriginal;
		yUnit = yUnitOriginal;
		// protože x jednotky jsou vypaisované zleva
		cxOffset = -(xCenter - xUnit) * cxUnit;
		cyOffset = yCenter * cyUnit;
		paint();
	}

	let roundUnit = function(unit) {
		return Number(unit.toPrecision(2));
	};

	let paint = function() {		
		ctx.clearRect(0, 0, width, height);
		ctx.strokeStyle = "grey";
		ctx.fillStyle = "grey";
		let fontSize = 13;
		let fontOffset = 8;
		let axesDrawTolerance = fontSize + fontOffset;
		ctx.font = fontSize + "px Monospace";		
		
		ctx.strokeRect(0, 0, width, height);

		let pointSize = 3;
		
		calibrate();

		let xOffset = Math.floor(cxOffset / axisUnitPxSize);
		let yOffset = Math.floor(cyOffset / axisUnitPxSize);	
		let cxOffsetRest = cxOffset % axisUnitPxSize;
		let cyOffsetRest = cyOffset % axisUnitPxSize;

		// aby se eliminoval přeskok "zubů" kolem nuly
		if (cxOffsetRest < 0)
			cxOffsetRest += axisUnitPxSize;
		if (cyOffsetRest < 0)
			cyOffsetRest += axisUnitPxSize;

		let fromX = -Math.floor(xLength / 2) - xOffset * xUnit;
		let toX = fromX + xLength;
		let fromY = -Math.floor(yLength / 2) + yOffset * yUnit;
		let toY = fromY + yLength;
		
		// poloha hlavních osy 
		let cxZero = - fromX * cxUnit + cxOffsetRest;		
		let cyZero = height + fromY * cyUnit + cyOffsetRest;		
		
		// Jednotky na osách a popisky
		ctx.setLineDash([5, 5]);
		ctx.strokeStyle = "lightgrey";
		ctx.fillStyle = "grey";
		ctx.textAlign = "left";	
		
		// X osa
		// je od -1, protože se písmo zobrazuje vpravo, když
		// se tedy při scrollu objeví nová položka, písmo by 
		// se najednou zobrazilo, namísto toho, aby vyjelo
		// již vykreslené, proto se zleva kreslí o 1 navíc
		for (let i = -1; i <= xAxisSteps; i++) {	
			let axisNumber = xUnit * i + fromX;
			let cx = cxZero + axisNumber * cxUnit;			
			let textX = cx + fontOffset;

			ctx.beginPath();
			ctx.moveTo(cx, 0);
			ctx.lineTo(cx, height);
			ctx.stroke();		
			ctx.textAlign = "left";
			ctx.fillText(roundUnit(axisNumber), textX, cyZero - fontOffset);	
		}
		
		// Y osa		
		for (let i = 0; i <= yAxisSteps; i++) {		
			let axisNumber = yUnit * i + fromY;
			let cy = cyZero - axisNumber * cyUnit;		
	
			ctx.beginPath();
			ctx.moveTo(0, cy);
			ctx.lineTo(width, cy);
			ctx.stroke();

			let textY = cy - fontOffset;					
			ctx.fillText(roundUnit(axisNumber), cxZero + fontOffset, textY);				
		}					
		
		// Hlavní čáry os
		ctx.setLineDash([]);
		ctx.strokeStyle = "grey";
		ctx.fillStyle = "grey";

		// x osa grafu		
		ctx.beginPath();
		ctx.moveTo(0, cyZero);
		ctx.lineTo(width, cyZero);
		ctx.stroke();
		
		// y osa grafu		
		ctx.beginPath();
		ctx.moveTo(cxZero, 0);
		ctx.lineTo(cxZero, height);
		ctx.stroke();	
					
		// PLOT
		let stepX = 1 / cxUnit;
		// -xUnit protože jednotky X jsou vypisované zleva a graf by se
		// dokresloval u levého kraje skokově
		for (let x = fromX - xUnit; x <= toX; x += stepX) {
			let cx = x * cxUnit + cxZero;
			let cy = cyZero - func(x) * cyUnit;
			ctx.fillStyle = "blue";
			ctx.fillRect(cx - pointSize / 2, cy - pointSize / 2, pointSize, pointSize);
		}
	};

	canvas.addEventListener("wheel", function(e) {
		e.preventDefault();
		let step = 1.1;
		if (e.deltaY > 0) {
			xUnit *= step;
			yUnit *= step;
		} else {
			xUnit /= step;
			yUnit /= step;
		}
		paint();
	});	
		
	canvas.addEventListener("mousedown", function (e) {
		dragged = true;
		draggedStartX = e.clientX;
		draggedStartY = e.clientY;
	}, false);
 
	canvas.addEventListener("mouseup", function (e) {
		dragged = false;
	}, false);
	
	canvas.addEventListener("mouseleave", function (e) {
		dragged = false;
	}, false);
	
	canvas.addEventListener("mousemove", function (e) {
		if (!dragged) 
			return;
		cxOffset -= (draggedStartX - e.clientX);
		cyOffset -= (draggedStartY - e.clientY);
		draggedStartX = e.clientX;
		draggedStartY = e.clientY;		
		paint();
	}, false);
	
	canvas.addEventListener("dblclick", function (e) {
		e.preventDefault();
		init();		
	}, false);

	return {
		start: function() {
			init();
		}
	};
	
})();

$.plotter.start();
</script>
</body>
</html>